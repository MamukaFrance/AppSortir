{% extends 'base.html.twig' %}

{% block title %}
    {{ parent() }} | Créer une sortie
{% endblock %}

{% block body %}
    <h1>Créer une sortie</h1>

    {# Afficher le formulaire courseForm #}

    {# Ouvrir le formulaire #}
    {{ form_start(sortieForm) }}

    {# Afficher tout les champs #}
    {{ form_widget(sortieForm) }}

    <button type="submit" class="uk-button uk-button-primary uk-width-1-1 uk-margin">Envoyer</button>

    {# Fermer le formulaire #}
    {{ form_end(sortieForm) }}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let villeSelect = document.querySelector('#sortie_ville');
            let lieuSelect = document.querySelector('#sortie_idLieu');

            villeSelect.addEventListener('change', function () {
                let villeId = this.value;

                // Clear current options
                lieuSelect.innerHTML = '<option>Chargement...</option>';

                if (villeId) {
                    fetch('/sortie/lieux/by-ville/' + villeId)
                        .then(response => response.json())
                        .then(data => {
                            lieuSelect.innerHTML = '';
                            data.forEach(lieu => {
                                let option = document.createElement('option');
                                option.value = lieu.id;
                                option.textContent = lieu.nom;
                                lieuSelect.appendChild(option);
                            });
                        });
                } else {
                    lieuSelect.innerHTML = '<option>Sélectionnez d\'abord une ville</option>';
                }
            });
        });
    </script>

{% endblock %}

